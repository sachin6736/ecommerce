<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

	<title>Electro </title>

	<!-- 
    RTL version
-->
	<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/css/alertify.rtl.min.css" />
	<!-- Default theme -->
	<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/css/themes/default.rtl.min.css" />
	<!-- Semantic UI theme -->
	<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/css/themes/semantic.rtl.min.css" />
	<!-- Bootstrap theme -->
	<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/css/themes/bootstrap.rtl.min.css" />


	<!-- /alertify -->

	<!-- Google font -->
	<link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">

	<!-- Bootstrap -->
	<link type="text/css" rel="stylesheet" href="/home_css/bootstrap.min.css" />

	<!-- Slick -->
	<link type="text/css" rel="stylesheet" href="/home_css/slick.css" />
	<link type="text/css" rel="stylesheet" href="/home_css/slick-theme.css" />

	<!-- nouislider -->
	<link type="text/css" rel="stylesheet" href="/home_css/nouislider.min.css" />

	<!-- Font Awesome Icon -->
	<link rel="stylesheet" href="/home_css/font-awesome.min.css">

	<!-- Custom stlylesheet -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

	<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> -->

	<link type="text/css" rel="stylesheet" href="/home_css/style.css" />


	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
 		  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
 		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
 		<![endif]-->
	<style>
		.search-results {
			background-color: #fff;
			border: 1px solid #ddd;
			border-radius: 4px;
			box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
			max-height: 400px;
			overflow-y: auto;
			position: absolute;
			width: 100%;
			z-index: 1000;
		}

		.search-result-item {
			display: flex;
			align-items: center;
			padding: 10px;
			border-bottom: 1px solid #eee;
			cursor: pointer;
		}

		.search-result-item:last-child {
			border-bottom: none;
		}

		.search-result-item img {
			width: 50px;
			height: 50px;
			object-fit: cover;
			margin-right: 10px;
			border-radius: 50%;
		}

		.search-result-item div {
			display: flex;
			flex-direction: column;
		}

		.search-result-item .item-name {
			font-weight: bold;
		}

		.search-result-item .item-category {
			font-size: 12px;
			color: #666;
		}

		.item_img {
			display: flex;
			justify-content: flex-start;
			align-items: center;
			width: 120px;
			height: 100%;
		
		}

		.item_img img {
			width: 90%;
			height: 100px;
			z-index: 1;
		}

		.order_container {
			width: 100%;
			height: 40rem;
			background-color: rgba(0, 0, 255, 0);
			display: flex;
			flex-direction: column;
			justify-content: space-between;
		}

		.top_container {
			width: 100%;
			height: 49%;
			background-color: rgb(255, 255, 255);
			box-shadow: 0 0 10px 2px rgb(161, 161, 161);
			display: flex;
			flex-direction: row;
		}

		.down_container {
			width: 100%;
			height: 49%;
			background-color: beige;
			box-shadow: 0 0 19px 2px rgb(161, 161, 161);
			display: flex;
			justify-content: center;
			position: relative;
			padding: 20px 0;

		}

		address {
			margin: 30px;
			font-size: 15px;
			width: 30%;
			height: 100%;
		}

		.item_details {
			width: 60%;
			height: 100%;
			display: flex;
			justify-content: space-evenly;
			align-items: center;
			border-left: 2px solid rgb(216, 216, 216);
		}

		.item_details:hover {
			cursor: pointer;
		}

		.item_detail {
			display: flex;
			justify-content: center;
			flex-direction: column;
		}

		.item_detail strong:hover {
			color: rgb(0, 102, 255);
			cursor: pointer;
		}

	.status-bar-container {
    width: 100%;
    max-width: 800px;
    margin: 50px auto;
    padding: 20px;
    background-color: #fff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border-radius: 10px;
    position: relative;
}

.status-bar {
    display: flex;
    /* justify-content: space-between; */
	gap: 50px;
    align-items: center;
    position: relative;
    padding: 0 20px;
}

.status-bar-line {
    content: "";
    position: absolute;
    top: 50%;
    left: 10%;
    width: 80%;
    height: 4px;
    background-color: #ddd;
    z-index: 0;
    transform: translateY(-50%);
}

.status-bar-progress {
    position: absolute;
    top: 50%;
    left: 10%;
    width: 0%; /* Start with 0% width */
    height: 4px;
    background-color: #28a745;
    z-index: 1;
    transform: translateY(-50%);
    transition: width 0.5s ease-in-out; /* Smooth transition */
}

.status-step {
    position: relative;
    z-index: 2;
    text-align: center;
    width: 25%;
}

.step-circle {
    width: 50px;
    height: 50px;
    background-color: #ddd;
    border-radius: 50%;
    margin-left:40px ;
	margin-top:20px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 20px;
    color: #333;
    transition: background-color 0.3s;
}

.status-step.active .step-circle {
    background-color: #28a745;
    color: #fff;
}

.step-label {
    font-size: 14px;
    color: #333;
}
	</style>
</head>

<body>
	<!-- HEADER -->
	<header>
		<!-- TOP HEADER -->
		<div id="top-header">
			<div class="container">

				<ul class="header-links pull-right">

					<% if (isAuth) { %>
						<li><a href="/user_Account"><i class="fa fa-user-o"></i>
								<%= USER.firstname%>
							</a></li>
						<a href="/logout_user">Logout</a>
						<% }else {%>

							<li><a href="/login"><i class="fa fa-user-o"></i> Login</a></li>

							<% } %>

				</ul>
			</div>
		</div>
		<!-- /TOP HEADER -->

		<!-- MAIN HEADER -->
		<div id="header">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">
					<!-- LOGO -->
					<div class="col-md-3">
						<div class="header-logo">
							<a href="/electro" class="logo">
								<img src="./img/logo.png" alt="">
							</a>
						</div>
					</div>
					<!-- /LOGO -->

					<!-- SEARCH BAR -->
					<div class="col-md-6">
						<div class="header-search">
							<form style="display: flex;">
								<input
									style="border-top-left-radius: 50px;border-bottom-left-radius: 50px;border-top-right-radius: 50px;border-bottom-right-radius: 50px;width: 600px;"
									class="input" id="searchInput" name="query" placeholder="Search here...."
									oninput="debouncedSearch()">

							</form>
							<div id="spinner" style="display: none;color: red;">
								<i class="fas fa-spinner fa-spin"></i> Searching...
							</div>
							<div id="search-results" class="search-results" style="display: none;">
								<!-- Search results will be injected here -->
							</div>
						</div>

					</div>
					<!-- /SEARCH BAR -->

					<!-- ACCOUNT -->
					<div class="col-md-3 clearfix" ;">
						<div class="header-ctn">
							<!-- Wishlist -->
							<%if(isAuth){%>

								<div>
									<a href="/wishlist">
										<i class="fa fa-heart-o"></i>
										<span>My Wishlist</span>
										<div class="qty">
											<%= wishlist_count %>
										</div>
									</a>
								</div>
								<!-- /Wishlist -->

								<!-- Cart -->
								<div class="dropdown">
									<a class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
										<i class="fa fa-shopping-cart"></i>
										<span>My Cart</span>
										<div class="qty">
											<%= Item_Count %>
										</div>
									</a>
									<div class="cart-dropdown">
										<div class="cart-list">
											<% Cart.forEach(cart=> { %>
												<% Products.forEach(product=> { %>
													<% cart.items.forEach(item=> { %>

														<% if (item.product_Id.toString()===product._id.toString()) { %>
															<div class="product-widget">
																<div class="product-img">
																	<img src="/Product_images/<%= product.images[0] %>"
																		alt="">
																</div>
																<div class="product-body">
																	<h3 class="product-name"><a href="#">
																			<%= product.name %>
																		</a></h3>
																	<h4 class="product-price"><span class="qty">
																			<%= item.Quantity %>
																		</span><i class="fa fa-rupee"></i>
																		<%= product.price %>
																	</h4>
																</div>
																<button class="delete"><i
																		class="fa fa-close"></i></button>
															</div>

															<% } %>

																<% }) %>

																	<% }) %>
																		<% }) %>

										</div>
										<div class="cart-summary">
											<small> Item(s) selected</small>
											<h5>SUBTOTAL: <i class="fa fa-rupee"></i>
												<%= TotalPrice %>
											</h5>
										</div>
										<div class="cart-btns">
											<a href="/cart">View Cart</a>
											<a href="/checkout">Checkout <i class="fa fa-arrow-circle-right"></i></a>
										</div>
									</div>
								</div>
								<% } else {%>
									<div>
										<a href="/login">
											<i class="fa fa-heart-o"></i>
											<span>My Wishlist</span>
											<div class="qty">
												<%= wishlist_count %>
											</div>
										</a>
									</div>
									<div class="dropdown">
										<a class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true"
											href="/login">
											<i class="fa fa-shopping-cart"></i>
											<span>Your Cart</span>
											<div class="qty">0</div>
										</a>
										<!-- <div class="cart-dropdown">
											<div class="cart-list">
											</div>
											<div class="cart-summary">
												<small>Item(s) selected</small>
												<h5>SUBTOTAL:<i class="fa fa-rupee"></i>
												
												</h5>
											</div>
											<div class="cart-btns">
												<a href="#">View Cart</a>
												<a href="/checkout">Checkout <i
														class="fa fa-arrow-circle-right"></i></a>
											</div> -->
									</div>
						</div>

						<% } %>
							<!-- /Cart -->

							<!-- Menu Toogle -->
							<div class="menu-toggle">
								<a href="#">
									<i class="fa fa-bars"></i>
									<span>Menu</span>
								</a>
							</div>
							<!-- /Menu Toogle -->
					</div>
				</div>
				<!-- /ACCOUNT -->
			</div>
			<!-- row -->
		</div>
		<!-- container -->
		</div>
		<!-- /MAIN HEADER -->
	</header>
	<!-- /HEADER -->



	<!-- NAVIGATION -->
	<nav id="navigation">
		<!-- container -->
		<div class="container">
			<!-- responsive-nav -->
			<div id="responsive-nav">
				<!-- NAV -->
				<ul class="main-nav nav navbar-nav">
					<li class="active"><a href="/electro">Home</a></li>
					<li id="new_products"><a href="/new_products">New Arrivals</a></li>
					<% Categories.forEach(category=> { %>
						<li><a class="active" href="/store/<%= category._id %> ">
								<%= category.name %>
							</a></li>

						<% }) %>

				</ul>
				<!-- /NAV -->
			</div>
			<!-- /responsive-nav -->
		</div>
		<!-- /container -->
	</nav>
	<!-- /NAVIGATION -->

	<!-- BREADCRUMB -->
	<div id="breadcrumb" class="section">
		<!-- container -->
		<div class="container">
			<!-- row -->


			<div class="order_container">
				<div class="top_container">
					<address>
						<h5>Delivery Adddress</h5>
						<% Address_for_Delivery.forEach(address=> { %>

							<strong>
								<%=USER.firstname%>
									<%= USER.lastname %>
							</strong>
							<p>
								<%=address.house_name %> ,<%=address.street %>
										<%=address.area %>
							</p>
							<p>
								<%=address.district %>
									<%=address.pincode %>
							</p>

							<h5>Contact no:</h5>
							<number>
								<%=USER.Phone_Number%>
							</number>

							<% }) %>


					</address>
					<div class="item_details">
						<div class="item_img">
							<img src="/Product_images/<%= delivery_item.images[0] %>" alt="">

						</div>

						<div class="item_detail">
							<input type="text" hidden id="item" value="<%= delivery_item._id %>">
							<strong onclick="window.location.href='/product/<%= delivery_item._id %>'">
								<%= delivery_item.name%>
							</strong>
							<p><i class="fa fa-rupee"></i>
								<%=delivery_item.price%>
							</p>
							<div class="product-rating" style="color: green;">
								<% if (review) { %>

									<% for (let i=1; i <=5; i++) { %>
										<% if (i <=review.rating) { %>
											<i class="fa fa-star"></i>
											<% } %>
												<% } %>
													<% } %>
							</div>
							<strong>Expected Delivery Date : <%= new Date(deliveryDate).toLocaleDateString('en-US', {
									year: 'numeric' , month: 'long' , day: 'numeric' }) %></strong>

						</div>
						<div
							style="width: 30%;height: 100%; display: flex;align-items: center; justify-content: flex-end;">
							<a href="/rate_review_product/<%= delivery_item._id %>"><i class="fa fa-star"
									style="color:rgb(128, 0, 0);color: blue;"></i>Rate & Review the product</a>
						</div>
					</div>

				</div>
				<div class="status-bar-container">
					<div class="status-bar">
						<div class="status-bar-line"></div>
						<div class="status-bar-progress" id="progress-bar"></div>
						<div class="status-step">
							<div class="step-circle"><i class="fas fa-receipt"></i></div>
							<div class="step-label">Order Confirmed</div>
						</div>
						<div class="status-step">
							<div class="step-circle"><i class="fas fa-box"></i></div>
							<div class="step-label">Shipped</div>
						</div>
						<div class="status-step">
							<div class="step-circle"><i class="fas fa-truck"></i></div>
							<div class="step-label">Out for Delivery</div>
						</div>
						<div class="status-step">
							<div class="step-circle"><i class="fas fa-check"></i></div>
							<div class="step-label">Delivered</div>
						</div>
					</div>
				</div>

				<!-- /container -->
			</div>

			<!-- /BREADCRUMB -->
			<!-- SECTION -->
			<div class="section">
				<!-- container -->
				<div class="container">
					<!-- row -->



					<!-- /row -->
				</div>
				<!-- /container -->
			</div>
			<!-- /SECTION -->


			<!-- FOOTER -->
		 
			<!-- /FOOTER -->


			<script>

document.addEventListener("DOMContentLoaded", async function() {
    let item_id = document.getElementById("item").value;
    console.log(item_id);

    try {
        let response = await fetch(`/track_status/${item_id}`, {
            method: "GET",
        });

        if (response.ok) {
            let data = await response.json();
            console.log(data.Order_Status);

            let progressBar = document.getElementById("progress-bar");
            let statusSteps = document.getElementsByClassName("status-step");
            let statusArray = ["Order Confirmed", "Shipped", "Out for Delivery", "Delivered"];

            // Find the index of the current status
            let statusIndex = statusArray.indexOf(data.Order_Status);
			
		   
              
			let progressPercentage;
            // Find the index of the current status
			switch(data.Order_Status){
			case  'Order Confirmed':	
			progressPercentage=0
			break;
			case  'Shipped':	
			progressPercentage=25
			break;
			case  'Out for Delivery':	
			progressPercentage=50
			break;
			case  'Delivered':	
			progressPercentage=80
			break;
			default :progressPercentage=0
			}
			
          console.log(progressPercentage)
		  progressBar.style.width= `${progressPercentage}%`
				for (let i = 0; i <= statusIndex  ; i++) {
		
                    statusSteps[i].classList.add("active");
                }
        }
    } catch (error) {
        console.error("Error fetching order status:", error);
    }
});

				let debouncedtimer;
				function debouncedSearch() {
					clearTimeout(debouncedtimer)
					debouncedtimer = setTimeout(() => {
						search_it()
					}, 300);
				}

				async function search_it() {
					let input = document.getElementById("searchInput").value
					let query = new URLSearchParams({ query: input })
					let resultcontainer = document.getElementById("search-results")
					let Spinner = document.getElementById("spinner")

					if (input.trim() === "") {
						resultcontainer.style.display = "none"
						return;
					}
					Spinner.style.display = "block"
					resultcontainer.style.display = "none"
					resultcontainer.innerHTML = ""


					try {
						let response = await fetch(`/search_product?${query}`, {
							method: 'GET'
						})
						console.log(response)
						if (response.ok) {
							let data = await response.json()
							if (data) {
								console.log(data)
								show_products(data.Products)
								Spinner.style.display = "none"


							} else {
								resultcontainer.innerHTML = "<p>No results found.</p>";
								resultcontainer.style.display = "block";
							}
						}
						else {
							alert("false")
						}
					}
					catch (error) {
						console.log(error.message)
					}

				}

				function show_products(products) {
					const resultsContainer = document.getElementById("search-results");

					if (products.length === 0) {
						resultsContainer.innerHTML = "<p>No results found.</p>";
					} else {
						const list = document.createElement("ul");
						list.style.listStyleType = "none";
						list.style.padding = "0";

						products.forEach(product => {
							const listItem = document.createElement("li");
							listItem.style.display = "flex";
							listItem.style.alignItems = "center";
							listItem.style.padding = "10px";
							listItem.style.borderBottom = "1px solid #ddd";

							const image = document.createElement("img");
							image.src = `/Product_images/${product.images[0]}`;
							image.style.width = "50px";
							image.style.marginRight = "10px";

							const link = document.createElement("a");
							link.href = `/product/${product._id}`;
							link.textContent = product.name;
							link.style.flex = "1";

							listItem.appendChild(image);
							listItem.appendChild(link);
							list.appendChild(listItem);
						});

						resultsContainer.innerHTML = "";
						resultsContainer.appendChild(list);
					}

					resultsContainer.style.display = "block";
				}





			</script>
			<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

			<script src=" //cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/alertify.min.js"></script>
			<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
			<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
			<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
			<!-- jQuery Plugins -->
			<script src="js/jquery.min.js"></script>
			<script src="js/bootstrap.min.js"></script>
			<script src="js/slick.min.js"></script>
			<script src="js/nouislider.min.js"></script>
			<script src="js/jquery.zoom.min.js"></script>
			<script src="js/main.js"></script>

			<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


</body>

</html>